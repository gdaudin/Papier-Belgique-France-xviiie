version 14global dir "~/Documents/Recherche/Commerce XVIIIe-XIXe Europe/Belgique/Papier Ann - Loïc/Statistiques"cd "$dir"capture program drop graphiques_en_quantitéprogram graphiques_en_quantitélocal bien `1'local direction `2'*exemple : graphiques_en_quantité 0a import//   graphiques_en_quantité 0b export...if "`bien'"==	"0a" local title ="European foodstuff and live animals" if "`bien'"==	"0b" local title ="Exotic foodstuff" if "`bien'"==	"1" local title ="Drinks and tobacco" if "`bien'"==	"2" local title ="Crude materials, inedible, except fuels"if "`bien'"==	"3" local title ="Fuels" if "`bien'"==	"4" local title ="Oils" if "`bien'"==	"5" local title ="Chemical products" if "`bien'"==	"6a" local title ="Leather products" if "`bien'"==	"6b" local title ="Wood products" if "`bien'"==	"6c" local title ="Paper products" if "`bien'"==	"6d" local title ="Linen products"if "`bien'"==	"6e" local title ="Wool products"if "`bien'"==	"6f" local title ="Silk products" if "`bien'"==	"6g" local title ="Coton products" if "`bien'"==	"6h" local title ="Mixed cloths (coton and linen)" if "`bien'"==	"6i" local title ="Other mixed textiles" if "`bien'"==	"6j" local title ="Metal products"if "`bien'"==	"6k" local title ="Other industrial product by composition"if "`bien'"==	"7" local title ="Machines and transport" if "`bien'"==	"8" local title ="Various manufactures" if "`bien'"==	"9a" local title ="Precious metals" if "`bien'"==	"9b" local title ="Mixed flows" use "Stata/RG_base courante.dta", clearkeep if sitc18_rev3 =="`bien'"replace quantity = quantity*8.7363/1000000 if unit=="guilders"replace unit = "silverton" if unit=="guilders"if "`direction'"=="import" keep if exportimport=="import"if "`direction'"=="export" keep if exportimport=="export"if "`direction'"=="imp_tran" keep if exportimport=="import" | exportimport=="transit"if "`direction'"=="imp_tran" replace exportimport="imp_tran"if "`direction'"=="exp_tran" keep if exportimport=="export" | exportimport=="transit"if "`direction'"=="exp_tran" replace exportimport="exp_tran"generate nbr_flux_tot=_Nbys unit : generate nbr_flux_unit=_Nlevelsof unit, local(unit_list)foreach unit of local unit_list {	levelsof nbr_flux_unit if unit=="`unit'", local(nbr_flux_unit)	*local nbr_flux_unit r(level)	display "`nbr_flux_unit'"	local prct_`unit'=  `nbr_flux_unit'/nbr_flux_tot	local prct_`unit' : display %3.2f `prct_`unit''	display "`prct_`unit''"}bys unit : drop if _N<0.15*nbr_flux_tottabulate unitlocal nbr_units = r(r)levelsof unit, local(unit_list)display `unit_list'collapse (sum) quantity , by(sitc18_rev3 exportimport unit year)gen id_flow = sitc18_rev3+"_"+exportimport+"_"+unitdrop sitc18_rev3 exportimport unitreshape wide quantity, i(year) j(id_flow) stringrename quantity* q*local i = 1foreach unit of local unit_list {	local unit`i' "`unit'"	local i = `i'+1}if `nbr_units' ==2 {	correlate q`bien'_`direction'_`unit1'  q`bien'_`direction'_`unit2'	if r(rho) > 0.5 {		local keep = "`keep'" + " `unit1'" + " `unit2'"	}}			if `nbr_units' ==3 {	correlate q`bien'_`direction'_`unit1'  q`bien'_`direction'_`unit2'	if r(rho) > 0.5 { 		local keep = "`keep'" + " `unit1'" + " `unit2'"		}	correlate q`bien'_`direction'_`unit1'  q`bien'_`direction'_`unit3'	if r(rho) > 0.5 {		local keep = "`keep'" + " `unit1'" + " `unit3'"		}	correlate q`bien'_`direction'_`unit2'  q`bien'_`direction'_`unit3'	if r(rho) > 0.5 {		local keep = "`keep'" + " `unit2'" + " `unit3'"		}}					if `nbr_units' ==4 {	correlate q`bien'_`direction'_`unit1'  q`bien'_`direction'_`unit2'	if r(rho) > 0.5 { 		local keep = "`keep'" + " `unit1'" + " `unit2'"		}	correlate q`bien'_`direction'_`unit1'  q`bien'_`direction'_`unit3'	if r(rho) > 0.5 {		local keep = "`keep'" + " `unit1'" + " `unit3'"		}	correlate q`bien'_`direction'_`unit1'  q`bien'_`direction'_`unit4'	if r(rho) > 0.5 {		local keep = "`keep'" + " `unit1'" + " `unit4'"		}	correlate q`bien'_`direction'_`unit2'  q`bien'_`direction'_`unit3'	if r(rho) > 0.5 {		local keep = "`keep'" + " `unit2'" + " `unit3'"		}		correlate q`bien'_`direction'_`unit2'  q`bien'_`direction'_`unit4'	if r(rho) > 0.5 {		local keep = "`keep'" + " `unit2'" + " `unit4'"		}		correlate q`bien'_`direction'_`unit3'  q`bien'_`direction'_`unit4'	if r(rho) > 0.5 {		local keep = "`keep'" + " `unit3'" + " `unit4'"		}}		if `nbr_units' ==5 {stop	correlate q`bien'_`direction'_`unit1'  q`bien'_`direction'_`unit2'	if r(rho) > 0.5 { 		local keep = "`keep'" + " `unit1'" + " `unit2'"		}	correlate q`bien'_`direction'_`unit1'  q`bien'_`direction'_`unit3'	if r(rho) > 0.5 {		local keep = "`keep'" + " `unit1'" + " `unit3'"		}	correlate q`bien'_`direction'_`unit1'  q`bien'_`direction'_`unit4'	if r(rho) > 0.5 {		local keep = "`keep'" + " `unit1'" + " `unit4'"		}	correlate q`bien'_`direction'_`unit2'  q`bien'_`direction'_`unit3'	if r(rho) > 0.5 {		local keep = "`keep'" + " `unit2'" + " `unit3'"		}		correlate q`bien'_`direction'_`unit2'  q`bien'_`direction'_`unit4'	if r(rho) > 0.5 {		local keep = "`keep'" + " `unit2'" + " `unit4'"		}		correlate q`bien'_`direction'_`unit3'  q`bien'_`direction'_`unit4'	if r(rho) > 0.5 {		local keep = "`keep'" + " `unit3'" + " `unit4'"		}}	foreach unit of local unit_list {			if strmatch(" `keep'","*`unit'*")!=1 {		drop q`bien'_`direction'_`unit'	}}		save "Stata/`bien'_`direction'.dta", replace*Puis la France*******use "~/Documents/Recherche/Commerce International Français XVIIIe.xls/Balance du commerce/Retranscriptions_Commerce_France/Données Stata/bdd courante.dta", clearkeep if strmatch(pays_grouping,"*Flandre*")==1keep if sourcetype == "Objet Général" | sourcetype == "National par direction"destring year, replacereplace exportsimports = "Imports" if exportsimports == "Importations"replace exportsimports = "Exports" if exportsimports == "Exportations"keep if sitc18_rev3=="`bien'"rename exportsimports exportimportif strmatch("`direction'","*imp*")==1  {	keep if exportimport=="Exports"	replace exportimport="importFR" if exportimport=="Exports"}if strmatch("`direction'","*exp*")==1 {	keep if exportimport=="Imports"	replace exportimport="exportFR" if exportimport=="Imports"}	replace value=value*4.47/1000000collapse (sum) value, by(year exportimport)reshape wide value, i(year) j(exportimport) stringmerge 1:1 year using "Stata/`bien'_`direction'.dta"drop _mergesave "Stata/`bien'_`direction'.dta", replaceuse "Stata/`bien'_`direction'.dta", clearsort yearquietly describeif "`direction'"=="import" & r(k) >=3 {	foreach var of varlist q*import* {		corr `var' valueimportFR		local position = ustrrpos("`var'","_")+1		local label_AN_axis = usubstr("`var'",`position',.)	    local label_AN_axis = "`label_AN_axis' (`prct_`label_AN_axis'')"		local label_AN_axis = usubinstr("`label_AN_axis'","silverton","silver ton",.)		local corr : display %3.2f r(rho)		twoway (connected valueimportFR year, yaxis(1) ) (line `var' year, yaxis(2) ),/*		*/ legend(label(1 "From France to AN (FR)") label(2 "From World to AN (AN)")) ytitle("silver ton", axis(1)) ytitle("`label_AN_axis'", axis(2)) title("`title'") subtitle("Corr : `corr'")		graph export "Graphiques/`bien'_`var'I.png", replace	}}if "`direction'"=="export"  & r(k) >=3 {	foreach var of varlist q*export* {		corr `var' valueexportFR		local position = ustrrpos("`var'","_")+1		local label_AN_axis = usubstr("`var'",`position',.)	    local label_AN_axis = "`label_AN_axis' (`prct_`label_AN_axis'')"		local label_AN_axis = usubinstr("`label_AN_axis'","silverton","silver ton",.)		local corr : display %3.2f r(rho)		twoway (connected valueexportFR year, yaxis(1) ) (line `var' year, yaxis(2) ),/*		*/ legend(label(1 "From AN to France (FR)") label(2 "From AN to World (AN)")) ytitle("silver ton", axis(1)) ytitle("`label_AN_axis'", axis(2)) title("`title'") subtitle("Corr : `corr'")		graph export "Graphiques/`bien'_`var'X.png", replace	}}	if "`direction'"=="imp_tran" & r(k) >=3 {	foreach var of varlist q*imp* {		corr `var' valueimportFR		local position = ustrrpos("`var'","_")+1		local label_AN_axis = usubstr("`var'",`position',.)	    local label_AN_axis = "`label_AN_axis' (`prct_`label_AN_axis'')"		local label_AN_axis = usubinstr("`label_AN_axis'","silverton","silver ton",.)		local corr : display %3.2f r(rho)		twoway (connected valueimportFR year, yaxis(1) ) (line `var' year, yaxis(2) ),/*		*/ legend(label(1 "From France to AN (FR)") label(2 "From World to AN (including transit) (AN)") size(small)) ytitle("silver ton", axis(1)) ytitle("`label_AN_axis'", axis(2)) title("`title'") subtitle("Corr : `corr'")		graph export "Graphiques/`bien'_`var'I+T.png", replace	}}if "`direction'"=="exp_tran"  & r(k) >=3 {	foreach var of varlist q*exp* {		corr `var' valueexportFR		local position = ustrrpos("`var'","_")+1		local label_AN_axis = usubstr("`var'",`position',.)	    local label_AN_axis = "`label_AN_axis' (`prct_`label_AN_axis'')"		local label_AN_axis = usubinstr("`label_AN_axis'","silverton","silver ton",.)		local corr : display %3.2f r(rho)		twoway (connected valueexportFR year, yaxis(1) ) (line `var' year, yaxis(2) ),/*		*/ legend(label(1 "From AN to France (FR)") label(2 "From AN to World (including transit) (AN)") size(small)) ytitle("silver ton", axis(1)) ytitle("`label_AN_axis'", axis(2)) title("`title'") subtitle("Corr : `corr'")		graph export "Graphiques/`bien'_`var'X+T.png", replace	}}	erase "Stata/`bien'_`direction'.dta"end*/foreach code in 0a 0b "1" "2" "3" "4" "5" 6a 6b 6c 6d 6e 6f 6g 6h 6i 6j 6k "7" "8" 9a 9b {	graphiques_en_quantité `code' import	graphiques_en_quantité `code' export	graphiques_en_quantité `code' imp_tran	graphiques_en_quantité `code' exp_tran	}	*graphiques_en_valeur Sugar*graphiques_en_valeur Linen*graphiques_en_valeur Silk*graphiques_en_valeur "French wine"